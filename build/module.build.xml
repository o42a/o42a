<?xml version="1.0" encoding="UTF-8"?>
<!--
    Reusable Build Script
    Copyright (C) 2011 Ruslan Lopatin

    This file is part of o42a.

    o42a is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    o42a is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<project name="org.o42a.build.module">

	<property name="source.path" value="src"/>

	<import file="common.build.xml" />
	
	<target name="compile-tools" depends="compile-deps" unless="auto-build">
		<subant
			target="compile"
			inheritall="false"
			inheritrefs="false"
			taskname="${ant.project.name}">
			<filelist dir="${root.dir}">
				<file name="org.o42a.tools"/>
			</filelist>
		</subant>
	</target>
	
	<target name="apt" depends="compile-tools" if="auto-build">
		<mkdir taskname="${ant.project.name}" dir="generated"/>
		<mkdir taskname="${ant.project.name}" dir=".bin"/>
		<call-javac destdir=".bin">
			<compilerarg line="-proc:only"/>
			<compilerarg line="-s generated"/>
			<compilerarg line="-processorpath"/>
			<compilerarg path="${root.dir}/org.o42a.util/bin:${root.dir}/org.o42a.tools/bin"/>
		</call-javac>
	</target>

	<target name="compile" depends="apt" unless="auto-build">
		<mkdir taskname="${ant.project.name}" dir="generated"/>
		<mkdir taskname="${ant.project.name}" dir="${output..}"/>
		<call-javac>
			<compilerarg line="-s generated"/>
			<compilerarg line="-processorpath"/>
			<compilerarg path="${root.dir}/org.o42a.util/bin:${root.dir}/org.o42a.tools/bin"/>
		</call-javac>
		<antcall target="copy-resources"/>
	</target>

	<target name="copy-resources">
		<copy todir="${output..}" taskname="${ant.project.name}">
			<fileset dir="o42a"/>
		</copy>
	</target>

	<target name="_clean" unless="auto-build">
		<delete taskname="${ant.project.name}" dir="${output..}"/>
		<delete taskname="${ant.project.name}" dir="generated"/>
	</target>

</project>
